{"version":3,"file":"serialize.js","names":["_sdk","require","_state","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","value","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","_default","isDomObject","stringifyAsDom","serializeAsObject","exports","default","isPlainObject","Array","isArray","stripAncestorRefs","ancestors","undefined","result","key","prop","entries","includes","pop","cleaned","serialize","getSerializeOptions","stepsFromCommands","maxArgumentDepth","maxDepth","maxArgumentLength","maxLength","getConfig","nonNullReplacerWithDomSupport","Cypress","dom","isDom","stringify","_"],"sources":["../../../src/browser/serialize.ts"],"sourcesContent":["import { serialize } from \"allure-js-commons/sdk\";\nimport { getConfig } from \"./state.js\";\n\nexport default (value: unknown) => {\n  return isDomObject(value) ? stringifyAsDom(value) : serializeAsObject(value);\n};\n\nconst isPlainObject = (value: unknown): value is Record<string, unknown> =>\n  typeof value === \"object\" && value !== null && !Array.isArray(value);\n\nconst stripAncestorRefs = (value: unknown, ancestors: object[] = []): unknown => {\n  if (!isPlainObject(value)) {\n    return value;\n  }\n\n  const result: Record<string, unknown> = {};\n  ancestors.push(value);\n\n  for (const [key, prop] of Object.entries(value)) {\n    if (typeof prop === \"object\" && prop !== null) {\n      if (ancestors.includes(prop)) {\n        continue;\n      }\n      result[key] = stripAncestorRefs(prop, ancestors);\n    } else {\n      result[key] = prop;\n    }\n  }\n\n  ancestors.pop();\n  return result;\n};\n\nexport const serializeAsObject = (value: unknown) => {\n  if (isPlainObject(value)) {\n    const cleaned = stripAncestorRefs(value);\n    return serialize({ ...(cleaned as object) }, getSerializeOptions());\n  }\n  return serialize(value, getSerializeOptions());\n};\n\nconst getSerializeOptions = () => {\n  const {\n    stepsFromCommands: { maxArgumentDepth: maxDepth, maxArgumentLength: maxLength },\n  } = getConfig();\n\n  return { maxDepth, maxLength, nonNullReplacerWithDomSupport };\n};\n\nconst isDomObject = (value: unknown): value is object =>\n  typeof value === \"object\" && value !== null && Cypress.dom.isDom(value);\n\n// @ts-ignore\nconst stringifyAsDom = (value: object) => Cypress.dom.stringify(value, \"long\");\n\nconst nonNullReplacerWithDomSupport = (_: string, value: unknown) => {\n  if (typeof value === \"object\") {\n    // Exclude null properties to make the result more compact.\n    if (value === null) {\n      return undefined;\n    }\n\n    if (Cypress.dom.isDom(value)) {\n      // Window, document, and DOM element properties are serialized with Cypress.dom.stringify.\n      return stringifyAsDom(value);\n    }\n  }\n\n  // Use the implementation from allure-js-commons/sdk in all other cases.\n  return value;\n};\n"],"mappings":";;;;;;AAAA,IAAAA,IAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAD,OAAA;AAAuC,SAAAE,QAAAC,CAAA,EAAAC,CAAA,QAAAC,CAAA,GAAAC,MAAA,CAAAC,IAAA,CAAAJ,CAAA,OAAAG,MAAA,CAAAE,qBAAA,QAAAC,CAAA,GAAAH,MAAA,CAAAE,qBAAA,CAAAL,CAAA,GAAAC,CAAA,KAAAK,CAAA,GAAAA,CAAA,CAAAC,MAAA,WAAAN,CAAA,WAAAE,MAAA,CAAAK,wBAAA,CAAAR,CAAA,EAAAC,CAAA,EAAAQ,UAAA,OAAAP,CAAA,CAAAQ,IAAA,CAAAC,KAAA,CAAAT,CAAA,EAAAI,CAAA,YAAAJ,CAAA;AAAA,SAAAU,cAAAZ,CAAA,aAAAC,CAAA,MAAAA,CAAA,GAAAY,SAAA,CAAAC,MAAA,EAAAb,CAAA,UAAAC,CAAA,WAAAW,SAAA,CAAAZ,CAAA,IAAAY,SAAA,CAAAZ,CAAA,QAAAA,CAAA,OAAAF,OAAA,CAAAI,MAAA,CAAAD,CAAA,OAAAa,OAAA,WAAAd,CAAA,IAAAe,eAAA,CAAAhB,CAAA,EAAAC,CAAA,EAAAC,CAAA,CAAAD,CAAA,SAAAE,MAAA,CAAAc,yBAAA,GAAAd,MAAA,CAAAe,gBAAA,CAAAlB,CAAA,EAAAG,MAAA,CAAAc,yBAAA,CAAAf,CAAA,KAAAH,OAAA,CAAAI,MAAA,CAAAD,CAAA,GAAAa,OAAA,WAAAd,CAAA,IAAAE,MAAA,CAAAgB,cAAA,CAAAnB,CAAA,EAAAC,CAAA,EAAAE,MAAA,CAAAK,wBAAA,CAAAN,CAAA,EAAAD,CAAA,iBAAAD,CAAA;AAAA,SAAAgB,gBAAAhB,CAAA,EAAAC,CAAA,EAAAC,CAAA,YAAAD,CAAA,GAAAmB,cAAA,CAAAnB,CAAA,MAAAD,CAAA,GAAAG,MAAA,CAAAgB,cAAA,CAAAnB,CAAA,EAAAC,CAAA,IAAAoB,KAAA,EAAAnB,CAAA,EAAAO,UAAA,MAAAa,YAAA,MAAAC,QAAA,UAAAvB,CAAA,CAAAC,CAAA,IAAAC,CAAA,EAAAF,CAAA;AAAA,SAAAoB,eAAAlB,CAAA,QAAAsB,CAAA,GAAAC,YAAA,CAAAvB,CAAA,uCAAAsB,CAAA,GAAAA,CAAA,GAAAA,CAAA;AAAA,SAAAC,aAAAvB,CAAA,EAAAD,CAAA,2BAAAC,CAAA,KAAAA,CAAA,SAAAA,CAAA,MAAAF,CAAA,GAAAE,CAAA,CAAAwB,MAAA,CAAAC,WAAA,kBAAA3B,CAAA,QAAAwB,CAAA,GAAAxB,CAAA,CAAA4B,IAAA,CAAA1B,CAAA,EAAAD,CAAA,uCAAAuB,CAAA,SAAAA,CAAA,YAAAK,SAAA,yEAAA5B,CAAA,GAAA6B,MAAA,GAAAC,MAAA,EAAA7B,CAAA;AAAA,IAAA8B,QAAA,GAEvBX,KAAc,IAAK;EACjC,OAAOY,WAAW,CAACZ,KAAK,CAAC,GAAGa,cAAc,CAACb,KAAK,CAAC,GAAGc,iBAAiB,CAACd,KAAK,CAAC;AAC9E,CAAC;AAAAe,OAAA,CAAAC,OAAA,GAAAL,QAAA;AAED,IAAMM,aAAa,GAAIjB,KAAc,IACnC,OAAOA,KAAK,KAAK,QAAQ,IAAIA,KAAK,KAAK,IAAI,IAAI,CAACkB,KAAK,CAACC,OAAO,CAACnB,KAAK,CAAC;AAEtE,IAAMoB,kBAAiB,GAAG,SAApBA,iBAAiBA,CAAIpB,KAAc,EAAwC;EAAA,IAAtCqB,SAAmB,GAAA7B,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAA8B,SAAA,GAAA9B,SAAA,MAAG,EAAE;EACjE,IAAI,CAACyB,aAAa,CAACjB,KAAK,CAAC,EAAE;IACzB,OAAOA,KAAK;EACd;EAEA,IAAMuB,MAA+B,GAAG,CAAC,CAAC;EAC1CF,SAAS,CAAChC,IAAI,CAACW,KAAK,CAAC;EAErB,KAAK,IAAM,CAACwB,GAAG,EAAEC,IAAI,CAAC,IAAI3C,MAAM,CAAC4C,OAAO,CAAC1B,KAAK,CAAC,EAAE;IAC/C,IAAI,OAAOyB,IAAI,KAAK,QAAQ,IAAIA,IAAI,KAAK,IAAI,EAAE;MAC7C,IAAIJ,SAAS,CAACM,QAAQ,CAACF,IAAI,CAAC,EAAE;QAC5B;MACF;MACAF,MAAM,CAACC,GAAG,CAAC,GAAGJ,kBAAiB,CAACK,IAAI,EAAEJ,SAAS,CAAC;IAClD,CAAC,MAAM;MACLE,MAAM,CAACC,GAAG,CAAC,GAAGC,IAAI;IACpB;EACF;EAEAJ,SAAS,CAACO,GAAG,CAAC,CAAC;EACf,OAAOL,MAAM;AACf,CAAC;AAEM,IAAMT,iBAAiB,GAAId,KAAc,IAAK;EACnD,IAAIiB,aAAa,CAACjB,KAAK,CAAC,EAAE;IACxB,IAAM6B,OAAO,GAAGT,kBAAiB,CAACpB,KAAK,CAAC;IACxC,OAAO,IAAA8B,cAAS,EAAAvC,aAAA,KAAOsC,OAAO,GAAeE,mBAAmB,CAAC,CAAC,CAAC;EACrE;EACA,OAAO,IAAAD,cAAS,EAAC9B,KAAK,EAAE+B,mBAAmB,CAAC,CAAC,CAAC;AAChD,CAAC;AAAChB,OAAA,CAAAD,iBAAA,GAAAA,iBAAA;AAEF,IAAMiB,mBAAmB,GAAGA,CAAA,KAAM;EAChC,IAAM;IACJC,iBAAiB,EAAE;MAAEC,gBAAgB,EAAEC,QAAQ;MAAEC,iBAAiB,EAAEC;IAAU;EAChF,CAAC,GAAG,IAAAC,gBAAS,EAAC,CAAC;EAEf,OAAO;IAAEH,QAAQ;IAAEE,SAAS;IAAEE;EAA8B,CAAC;AAC/D,CAAC;AAED,IAAM1B,WAAW,GAAIZ,KAAc,IACjC,OAAOA,KAAK,KAAK,QAAQ,IAAIA,KAAK,KAAK,IAAI,IAAIuC,OAAO,CAACC,GAAG,CAACC,KAAK,CAACzC,KAAK,CAAC;;AAEzE;AACA,IAAMa,cAAc,GAAIb,KAAa,IAAKuC,OAAO,CAACC,GAAG,CAACE,SAAS,CAAC1C,KAAK,EAAE,MAAM,CAAC;AAE9E,IAAMsC,6BAA6B,GAAGA,CAACK,CAAS,EAAE3C,KAAc,KAAK;EACnE,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;IAC7B;IACA,IAAIA,KAAK,KAAK,IAAI,EAAE;MAClB,OAAOsB,SAAS;IAClB;IAEA,IAAIiB,OAAO,CAACC,GAAG,CAACC,KAAK,CAACzC,KAAK,CAAC,EAAE;MAC5B;MACA,OAAOa,cAAc,CAACb,KAAK,CAAC;IAC9B;EACF;;EAEA;EACA,OAAOA,KAAK;AACd,CAAC","ignoreList":[]}