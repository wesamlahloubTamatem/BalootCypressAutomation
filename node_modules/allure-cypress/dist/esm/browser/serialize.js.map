{"version":3,"file":"serialize.js","names":["serialize","getConfig","value","isDomObject","stringifyAsDom","serializeAsObject","isPlainObject","Array","isArray","stripAncestorRefs","ancestors","arguments","length","undefined","result","push","key","prop","Object","entries","includes","pop","cleaned","_objectSpread","getSerializeOptions","stepsFromCommands","maxArgumentDepth","maxDepth","maxArgumentLength","maxLength","nonNullReplacerWithDomSupport","Cypress","dom","isDom","stringify","_"],"sources":["../../../src/browser/serialize.ts"],"sourcesContent":["import { serialize } from \"allure-js-commons/sdk\";\nimport { getConfig } from \"./state.js\";\n\nexport default (value: unknown) => {\n  return isDomObject(value) ? stringifyAsDom(value) : serializeAsObject(value);\n};\n\nconst isPlainObject = (value: unknown): value is Record<string, unknown> =>\n  typeof value === \"object\" && value !== null && !Array.isArray(value);\n\nconst stripAncestorRefs = (value: unknown, ancestors: object[] = []): unknown => {\n  if (!isPlainObject(value)) {\n    return value;\n  }\n\n  const result: Record<string, unknown> = {};\n  ancestors.push(value);\n\n  for (const [key, prop] of Object.entries(value)) {\n    if (typeof prop === \"object\" && prop !== null) {\n      if (ancestors.includes(prop)) {\n        continue;\n      }\n      result[key] = stripAncestorRefs(prop, ancestors);\n    } else {\n      result[key] = prop;\n    }\n  }\n\n  ancestors.pop();\n  return result;\n};\n\nexport const serializeAsObject = (value: unknown) => {\n  if (isPlainObject(value)) {\n    const cleaned = stripAncestorRefs(value);\n    return serialize({ ...(cleaned as object) }, getSerializeOptions());\n  }\n  return serialize(value, getSerializeOptions());\n};\n\nconst getSerializeOptions = () => {\n  const {\n    stepsFromCommands: { maxArgumentDepth: maxDepth, maxArgumentLength: maxLength },\n  } = getConfig();\n\n  return { maxDepth, maxLength, nonNullReplacerWithDomSupport };\n};\n\nconst isDomObject = (value: unknown): value is object =>\n  typeof value === \"object\" && value !== null && Cypress.dom.isDom(value);\n\n// @ts-ignore\nconst stringifyAsDom = (value: object) => Cypress.dom.stringify(value, \"long\");\n\nconst nonNullReplacerWithDomSupport = (_: string, value: unknown) => {\n  if (typeof value === \"object\") {\n    // Exclude null properties to make the result more compact.\n    if (value === null) {\n      return undefined;\n    }\n\n    if (Cypress.dom.isDom(value)) {\n      // Window, document, and DOM element properties are serialized with Cypress.dom.stringify.\n      return stringifyAsDom(value);\n    }\n  }\n\n  // Use the implementation from allure-js-commons/sdk in all other cases.\n  return value;\n};\n"],"mappings":";;;;;AAAA,SAASA,SAAS,QAAQ,uBAAuB;AACjD,SAASC,SAAS,QAAQ,YAAY;AAEtC,eAAgBC,KAAc,IAAK;EACjC,OAAOC,WAAW,CAACD,KAAK,CAAC,GAAGE,cAAc,CAACF,KAAK,CAAC,GAAGG,iBAAiB,CAACH,KAAK,CAAC;AAC9E,CAAC;AAED,IAAMI,aAAa,GAAIJ,KAAc,IACnC,OAAOA,KAAK,KAAK,QAAQ,IAAIA,KAAK,KAAK,IAAI,IAAI,CAACK,KAAK,CAACC,OAAO,CAACN,KAAK,CAAC;AAEtE,IAAMO,kBAAiB,GAAG,SAApBA,iBAAiBA,CAAIP,KAAc,EAAwC;EAAA,IAAtCQ,SAAmB,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,EAAE;EACjE,IAAI,CAACL,aAAa,CAACJ,KAAK,CAAC,EAAE;IACzB,OAAOA,KAAK;EACd;EAEA,IAAMY,MAA+B,GAAG,CAAC,CAAC;EAC1CJ,SAAS,CAACK,IAAI,CAACb,KAAK,CAAC;EAErB,KAAK,IAAM,CAACc,GAAG,EAAEC,IAAI,CAAC,IAAIC,MAAM,CAACC,OAAO,CAACjB,KAAK,CAAC,EAAE;IAC/C,IAAI,OAAOe,IAAI,KAAK,QAAQ,IAAIA,IAAI,KAAK,IAAI,EAAE;MAC7C,IAAIP,SAAS,CAACU,QAAQ,CAACH,IAAI,CAAC,EAAE;QAC5B;MACF;MACAH,MAAM,CAACE,GAAG,CAAC,GAAGP,kBAAiB,CAACQ,IAAI,EAAEP,SAAS,CAAC;IAClD,CAAC,MAAM;MACLI,MAAM,CAACE,GAAG,CAAC,GAAGC,IAAI;IACpB;EACF;EAEAP,SAAS,CAACW,GAAG,CAAC,CAAC;EACf,OAAOP,MAAM;AACf,CAAC;AAED,OAAO,IAAMT,iBAAiB,GAAIH,KAAc,IAAK;EACnD,IAAII,aAAa,CAACJ,KAAK,CAAC,EAAE;IACxB,IAAMoB,OAAO,GAAGb,kBAAiB,CAACP,KAAK,CAAC;IACxC,OAAOF,SAAS,CAAAuB,aAAA,KAAOD,OAAO,GAAeE,mBAAmB,CAAC,CAAC,CAAC;EACrE;EACA,OAAOxB,SAAS,CAACE,KAAK,EAAEsB,mBAAmB,CAAC,CAAC,CAAC;AAChD,CAAC;AAED,IAAMA,mBAAmB,GAAGA,CAAA,KAAM;EAChC,IAAM;IACJC,iBAAiB,EAAE;MAAEC,gBAAgB,EAAEC,QAAQ;MAAEC,iBAAiB,EAAEC;IAAU;EAChF,CAAC,GAAG5B,SAAS,CAAC,CAAC;EAEf,OAAO;IAAE0B,QAAQ;IAAEE,SAAS;IAAEC;EAA8B,CAAC;AAC/D,CAAC;AAED,IAAM3B,WAAW,GAAID,KAAc,IACjC,OAAOA,KAAK,KAAK,QAAQ,IAAIA,KAAK,KAAK,IAAI,IAAI6B,OAAO,CAACC,GAAG,CAACC,KAAK,CAAC/B,KAAK,CAAC;;AAEzE;AACA,IAAME,cAAc,GAAIF,KAAa,IAAK6B,OAAO,CAACC,GAAG,CAACE,SAAS,CAAChC,KAAK,EAAE,MAAM,CAAC;AAE9E,IAAM4B,6BAA6B,GAAGA,CAACK,CAAS,EAAEjC,KAAc,KAAK;EACnE,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;IAC7B;IACA,IAAIA,KAAK,KAAK,IAAI,EAAE;MAClB,OAAOW,SAAS;IAClB;IAEA,IAAIkB,OAAO,CAACC,GAAG,CAACC,KAAK,CAAC/B,KAAK,CAAC,EAAE;MAC5B;MACA,OAAOE,cAAc,CAACF,KAAK,CAAC;IAC9B;EACF;;EAEA;EACA,OAAOA,KAAK;AACd,CAAC","ignoreList":[]}